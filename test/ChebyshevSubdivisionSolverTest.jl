include("../../Julia-Rootfinding/src/ChebyshevSubdivisionSolver.jl")
using Test

function test_all_ChebyshevSubdivisionSolver()
    @testset "All tests in ChebyshevSubdivisionSolverTest.jl" begin
        test_getLinearTerms()
        test_linearCheck1()
        test_reduceSolveDim()
        test_transformChebInPlace1D()
        test_transformChebInPlaceND()
        test_getTransformationError()
        test_transformCheb()
        test_transformChebToInterval()
    end
end

function test_getLinearTerms()
    @testset "getLinearTerms unit tests" begin
        M_1 = reshape(collect(0:15),(2,2,2,2))
        A_1_expected = [8; 4; 2; 1]
        @test isapprox(A_1_expected,getLinearTerms(M_1))

        M_2 = reshape(collect(0:15),(2,2,4))
        A_2_expected = [4; 2; 1]
        @test isapprox(A_2_expected,getLinearTerms(M_2))

        M_3 = [43.2;12.2;-9.2]
        A_3_expected = [12.2]
        @test isapprox(A_3_expected,getLinearTerms(M_3))
        
        M_4 = reshape(collect(0:(2*15*4*6-1)),(6,4,15,2))
        A_4_expected = [360; 24; 6; 1]
        @test isapprox(A_4_expected,getLinearTerms(M_4))

        M_5 = reshape(collect(0:(3*4-1)),(4,1,3))
        A_5_expected = [4; 0; 1]
        @test isapprox(A_5_expected,getLinearTerms(M_5))


    end
end

function test_linearCheck1()
    @testset "linearCheck1 unit tests" begin
        A1 = [-1.12215095; -0.10896646; -0.20570858;;
                1.61496991;  0.36087537;  0.70263142;;
                1.11501566;  1.00547594; -1.96518304]
        totalErrs1 = [3.04770461; 7.78421744; 7.01361619]
        consts1 = [1.06289306; -0.36122354;  2.87185328]
        expecteda1 = [0.17843629682798045621; -5.97541921291522903914; 0.35379575125989282114]
        expectedb1 = [0.13891640768525181926; 0.26299355308293126399; 2.56893787868228251625]
        ao1, bo1 = linearCheck1(totalErrs1,A1,consts1)
        @test isapprox(expecteda1,ao1)
        @test isapprox(expectedb1,bo1)

        A2 = [1.80704361; 0.16184698; 0.12777497;;
                -1.50763366; -0.0496367; -0.03896966;;
                1.1471166; 1.60014553; -1.22405313]
        totalErrs2 = [3.12346641; 7.35040987; 6.71495483]
        consts2 = [0.43827528; 0.03844889; 2.66922695]
        expecteda2 = [-0.72849531284969915035; -3.19646507402361113037; -0.12454345016870327356]
        expectedb2 = [0.19996601042997674824; -0.13976516248493942030; 4.48583608458237481642]
        ao2, bo2 = linearCheck1(totalErrs2,A2,consts2)
        @test isapprox(expecteda2,ao2)
        @test isapprox(expectedb2,bo2)

        A3 = [1.80704361; 0.16184698; 0.12777497;;
                -1.50763366; -0.0496367;  -0.03896966;;
                -1.50763366; -0.0496367;  0.03896966]
        totalErrs3 = [3.12346641; 7.35040987; 6.71495483]
        consts3 = [0.43827528; 0.03844889; 2.66922695]
        expecteda3 = [0.08697917370722585417; -18.29888596005930878619; -23.44505688398909626358]
        expectedb3 = [0.24342093216001564615; 12.88296432840451899438; 16.58494523614445270709]
        ao3,bo3 = linearCheck1(totalErrs3,A3,consts3)
        @test isapprox(expecteda3,ao3)
        @test isapprox(expectedb3,bo3)

        A4 = reshape([1.50001956],(1,1)) #1 dimensional test
        totalErrs4 = [1.50001956]
        consts4 = [0.]
        expecteda4 = [0.]
        expectedb4 = [0.]
        ao4,bo4 = linearCheck1(totalErrs4,A4,consts4)
        @test isapprox(expecteda4,ao4)
        @test isapprox(expectedb4,bo4)

        A5 = [-.843750000; -1.87818750; -1.84275000; -.0107162044; -.00639690758; -.0137320288;;
                1.76080078; -.211296094; -.207309375; -.0159523129; .00889275657; -.0159523129;;
                .000176557928; -.00280220616; -.000701926758;  .0750781250; -1.28906250; -.0703125000;;
                1.36514364; -.163754473; -.160664766; -.163754473; .00504338969; -.00586371477;;
                .0289072432; -.240222558; -1.16359475; -1.12860484; -.190846439; -1.11307774;;
                .0903976590; -1.43472955; -.359386500;  0.0; 0.0;  0.0]
        totalErrs5 = [13.43636626; 31.17953809; 5.93851452; 33.20880558; 10.53793091; 1601.6394327]
        consts5 = [-0.07413729; -0.19634937;  0.90146117;-0.16101726; -0.72744493;  0.71811873]
        expecteda5 = [-14.92458223407407302830; -6.15390037469634965106; -6.29147538190204791420; -8.33713070909743869663; -2.20821696387878763090; -8.46738087673912076525]
        expectedb5 = [14.74884939851851761716; 6.07495480616285643549; 6.21101162935829531619; 7.04802595920109808958; 3.60684762763636346250; 7.16029350294975763802]
        ao5,bo5 = linearCheck1(totalErrs5,A5,consts5)
        @test isapprox(expecteda5,ao5)
        @test isapprox(expectedb5,bo5)

        A6 = [-1.09679818; -.939093750; -.921375000; -.0138146058; -.00106830799; -.0137307266;;
                .915137070; -1.05695980; -1.03701717; -.0149230031; .00237984138; -.0298460061;;
                .000607404435; -.00309112001; .000675877264;  .0750781250; -1.10873059; -.0379851973;;
                1.42079568; -1.63828770; -1.60737661; -1.63828770; -.00611697632; -.00852711940;;
                .901029633; -.240222558; -1.16359475; -1.12860484; -.0167700634; -1.01490072;;
                .310991071; -1.58265345;  .346049159;  0.0; 0.0; 0.0]
        totalErrs6 = [5.35450865; 14.31962505; 5.26765467; 30.10577724; 8.74980906; 1261.57287396]
        consts6 = [-0.06306681; -1.04453075; 1.44087973; -1.64179371; 0.23798175; 0.63996163]
        expecteda6 = [-3.88194523626944754113; -4.70178286246713916796; -4.81143253289919847759; -6.33103852363418972971; -1.15191610254029308535; -7.15236938643614461597]
        expectedb6 = [3.76694356841474720099; 4.56746866859671918348; 4.67453537376203964726; 6.75276584849662775412; 3.75106821937689982605; 7.62134481488987525211]
        ao6,bo6 = linearCheck1(totalErrs6,A6,consts6)
        @test isapprox(expecteda6,ao6)
        @test isapprox(expectedb6,bo6)

        A7 = [0; -.939093750; 0; -.0138146058; -.00106830799; -.0137307266;;
                0; -1.05695980; 0; -.0149230031; .00237984138; -.0298460061;;
                0; 0;  0;  0; 0; 0;;
                0; -1.63828770; 0; -1.63828770; -.00611697632; -.00852711940;;
                0; 0; 0; 0; 0; 0;;
                0; 0;  0;  0.0; 0.0; 0.0]
        totalErrs7 = [5.35450865; 14.31962505; 5.26765467; 30.10577724; 8.74980906; 1261.57287396]
        consts7 = [-0.06306681; -1.04453075; 1.44087973; -1.64179371; 0.23798175; 0.63996163]
        expecteda7 = [-Inf; -4.70178286246713916796; -Inf; -17.37636774053788002448; -4920.67627681775957171340; -388.96542615596172254300]
        expectedb7 = [Inf; 4.56746866859671918348; Inf; 15.37208764980656283683; 4383.87717081762366433395; 379.77919561809636661565]
        ao7,bo7 = linearCheck1(totalErrs7,A7,consts7)
        @test isapprox(expecteda7,ao7)
        @test isapprox(expectedb7,bo7)
    end
end

function test_reduceSolveDim()
    @testset "reduceSolveDim unit tests" begin 
        # 2d case
        Ms_1 = [[3.1;-2;34;.000001;.0002;;4;1;2;.0002;.0102], [9.836;3.1;-.031;.001;-.045;.00002;;15.2344;42.234;2;4;3;.0023]]
        errors_1 = [.00002;.0001]
        trackedInterval_1 = TrackedInterval([1;1;;-3;2])
        trackedInterval_1.reducedDims = [1]
        trackedInterval_1.solvedVals = [1.;2.;3.]
        dim_1 = 0
        expected_new_Ms_1 = [[3.10000000000000008882; -2.00000000000000000000; 34.00000000000000000000; 0.00000100000000000000; 0.00020000000000000001]]
        expected_new_errors_1 = [0.00002]
        expected_new_trackedInterval_1 = [-3;2]

        new_Ms_1, new_errors_1, new_trackedInterval_1 = reduceSolvedDim(Ms_1,errors_1,trackedInterval_1,dim_1)
        @test isapprox(expected_new_Ms_1[1],new_Ms_1[1])
        @test isapprox(expected_new_errors_1,new_errors_1)
        @test isapprox(expected_new_trackedInterval_1,new_trackedInterval_1.interval)
        @test (1 == new_trackedInterval_1.ndim)
        @test ([1;0] == new_trackedInterval_1.reducedDims)
        @test ([1.; 2.; 3.; 1.0] == new_trackedInterval_1.solvedVals)

        # 3d case
        Ms_2 = [[5.1;-2;2.4;.000001;.0002;.001001;;18;4;2.12;.0002;.0102;.045;;5;3.2;4.2;11;.0002;.0909;;;8.12;3.332;4.1232;11;.012002;.091239;;45.23;34;7.23;2.0;.0002;.011239;;8.127;3.2;4.3;11;.012002;.093309;;;54.1;13.332;6.1232;12.1;.12;.12239;;4.2343;5.433;94.3;8.340;.012302;.11239;;77.127;81.2;5.3;1;.02;.03], [5.836;3.122;-.031;;13.234344;42.001;.0012;;5.9;13.0022333;.0056;;;3.2;12;.0023;;56.2;1;.00233;;5.2;4.5;.013;;;5.2;4.5;.013;;3.2;12;.0023;;5.2;4.5;.013],[2;2;.002;.001;;2.1;2.1;.0021;.001;;6.23;125;.004;.0021;;;8.23453;25;.004;.0021;;2;15;.0344;.00221;;14;1.9;.004;.023021;;;8;1.9;.004;.023021;;1;1.9;.004;.023021;;4;1.9;.004;.023021]]
        errors_2 = [.0001122;.00021;.00310102]
        trackedInterval_2 = TrackedInterval([-3;4;;4;19;;-2e-16;-1e-16])
        trackedInterval_2.reducedDims = []
        trackedInterval_2.solvedVals = []
        dim_2 = 2

        expected_new_Ms_2 = [[2.70019999999999971152; 15.89019999999999832596; 0.80019999999999980034;;4.00880199999999931038; 38.00019999999999953388; 3.83900200000000069167;;48.09680000000000177351; -90.05339799999998717794; 71.84699999999999420197],[5.86699999999999999289; 13.23314399999999935176; 5.89440000000000008384;;3.19770000000000020890; 56.19767000000000223281; 5.18700000000000027711;;5.18700000000000027711; 3.19770000000000020890; 5.18700000000000027711]]
        expected_new_errors_2 = [0.00011220000000000000; 0.00021000000000000001]
        expected_new_trackedInterval_2 = [-3.;4.;;4.;19.]

        new_Ms_2, new_errors_2, new_trackedInterval_2 = reduceSolvedDim(Ms_2,errors_2,trackedInterval_2,dim_2)
        println()
        println(new_Ms_2)
        @test isapprox(expected_new_Ms_2[1],new_Ms_2[1])
        @test isapprox(expected_new_Ms_2[2],new_Ms_2[2])
        @test isapprox(expected_new_errors_2,new_errors_2)
        @test isapprox(expected_new_trackedInterval_2,new_trackedInterval_2.interval)
        @test (2 == new_trackedInterval_2.ndim)
        @test ([2] == new_trackedInterval_2.reducedDims)
        @test ([-0.00000000000000015000] == new_trackedInterval_2.solvedVals)
    end
end

function test_transformChebInPlace1D()
    @testset "transformChebInPlace1D unit tests" begin
        alpha_1 = 0.8043138619259216
        beta_1 = 0.19568613807407842
        coeffs_1 = [1.6668764854819471; 0.502737971117991; 0.003441591526151544;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                            -1.20687653838567; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                            -0.018876295666785736; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_1 = [ 1.43592664172332273864;  0.50273797111799101156;  0.00344159152615154413;;
                                                    0.55750782907114360132;  0.;          0.;;
                                                    0.01239107183457751997;  0.;0.;;;
                                                    -0.98259152221737600108;  0.;0.;;
                                                    0.;0.;0.;;
                                                    0.;          0.;          0.;;;
                                                    -0.01221146807645548740;  0.;          0.;;
                                                    0.;          0.;          0.;;
                                                    0.;          0.;          0.]
        transformed_coeffs_1 = transformChebInPlace1D(coeffs_1,alpha_1,beta_1)
        @test isapprox(expected_transformed_coeffs_1,transformed_coeffs_1)

        alpha_2 = 0.561531793052032
        beta_2 = -0.43846820694796795
        coeffs_2 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_2 = [ 1.66687648548194711218; -1.20687653838567010567; -0.01887629566678573553 ;;
                                                0.55750782907114360132;  0.;          0.;;
                                                0.01239107183457751997;  0.;          0.;;;
                                                0.50273797111799101156;  0.;          0.;;
                                                0.;          0.;          0.;;
                                                0.;          0.;          0.;;;
                                                0.00344159152615154413;  0.;          0.;;
                                                0.;          0.;          0.;;
                                                0.;          0.;          0.]
        transformed_coeffs_2 = transformChebInPlace1D(coeffs_2,alpha_2,beta_2)
        @test isapprox(transformed_coeffs_2,expected_transformed_coeffs_2)
        
        alpha_3 = 0.561531793052032
        beta_3 = 0
        coeffs_3 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_3 = [ 2.06363273035505034869; -1.20687653838567010567; -0.01887629566678573553 ;;
                                                 0.55750782907114360132;  0.;          0.;;        
                                                 0.01239107183457751997;  0.;          0.;;;        
                                                 0.51348734263490647400;  0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.;;;
                                                 0.00344159152615154413;  0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.]
        transformed_coeffs_3 = transformChebInPlace1D(coeffs_3,alpha_3,beta_3)
        @test isapprox(transformed_coeffs_3,expected_transformed_coeffs_3)
        
        alpha_4 = 0
        beta_4 = -0.43846820694796795
        coeffs_4 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_4 = [ 1.66343489395579569035; -1.20687653838567010567; -0.01887629566678573553;;
                                                 0.55750782907114360132;  0.;          0.;;
                                                 0.01239107183457751997;  0.;          0.;;;    
                                                 0.;          0.;          0.;;        
                                                 0.;          0.;          0.;;        
                                                 0.;          0.;          0.]
        transformed_coeffs_4 = transformChebInPlace1D(coeffs_4,alpha_4,beta_4)
        @test isapprox(transformed_coeffs_4,expected_transformed_coeffs_4)
        
        alpha_5 = 0
        beta_5 = 0
        coeffs_5 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_5 = [ 2.06019113882889870482; -1.20687653838567010567; -0.01887629566678573553;;
                                                     0.55750782907114360132;  0.;          0.;;        
                                                     0.01239107183457751997;  0.;          0.;;;
                                                     0.;          0.;          0.;;        
                                                     0.;          0.;          0.;;        
                                                     0.;          0.;          0.]
        transformed_coeffs_5 = transformChebInPlace1D(coeffs_5,alpha_5,beta_5)
        @test isapprox(transformed_coeffs_5,expected_transformed_coeffs_5)
        
        alpha_6 = 1.000000082740371e-10
        beta_6 = -0.7266187050359711
        coeffs_6 = [10.1; 13.9]
        expected_transformed_coeffs_6 = [0.00000000000000000000; 0.00000000139000011501]
        transformed_coeffs_6 = transformChebInPlace1D(coeffs_6,alpha_6,beta_6)
        @test isapprox(transformed_coeffs_6,expected_transformed_coeffs_6)

        alpha_7 = 7.667826729776448e-06
        beta_7 = 0.0
        coeffs_7 = [0; 1.39000012e-09]
        expected_transformed_coeffs_7 = [0.00000000000000000000; 0.00000000000001065828]
        transformed_coeffs_7 = transformChebInPlace1D(coeffs_7,alpha_7,beta_7)
        @test isapprox(transformed_coeffs_7,expected_transformed_coeffs_7)

        alpha_8 = 0
        beta_8 = -0.7266187050359711
        coeffs_8 = [10.1; 13.9]
        expected_transformed_coeffs_8 = [0.0;0.0]
        transformed_coeffs_8 = transformChebInPlace1D(coeffs_8,alpha_8,beta_8)
        @test isapprox(transformed_coeffs_8,expected_transformed_coeffs_8)

        alpha_9 = 0
        beta_9 = 0
        coeffs_9 = [10.1; 13.9]
        expected_transformed_coeffs_9 = [10.09999999999999964473; 0.00000000000000000000]
        transformed_coeffs_9 = transformChebInPlace1D(coeffs_9,alpha_9,beta_9)
        @test isapprox(transformed_coeffs_9,expected_transformed_coeffs_9)

        alpha_10 = 0.5197277737990523
        beta_10 = -0.48027222620094767
        coeffs_10 = [-1.27278454e-02; 7.67937509e-02; -6.13381857e-02; -5.38708766e-02;
                    1.41766096e-02;  6.52808648e-03; -1.07489381e-03; -3.41236334e-04;
                    4.12240520e-05;  1.00310107e-05; -9.59578551e-07; -1.89618788e-07;
                    1.50313164e-08;  2.50245049e-09; -1.69453828e-10; -2.43827788e-11;
                    1.44149276e-12;  1.82690668e-13; -9.54097912e-15; -1.06772230e-15;;
                    4.65987370e-02;  1.23340236e-01;  2.24569195e-01; -8.65232725e-02;
                    -5.19029012e-02;  1.04849121e-02;  3.93536318e-03; -5.48067641e-04;
                    -1.50928040e-04;  1.61110404e-05;  3.51317503e-06; -3.04551162e-07;
                    -5.50321239e-08;  4.01924410e-09;  6.20398379e-10; -3.91616600e-11;
                    -5.27744515e-12;  2.93404190e-13;  3.50275364e-14; -1.80758186e-15;;
                    -2.87478641e-02;  1.73450906e-01; -1.38542053e-01; -1.21675947e-01;
                    3.20201285e-02;  1.47447221e-02; -2.42781871e-03; -7.70736558e-04;
                    9.31110811e-05;  2.26566338e-05; -2.16736085e-06; -4.28284206e-07;
                    3.39506200e-08;  5.65218263e-09; -3.82738438e-10; -5.50723391e-11;
                    3.25587474e-12;  4.12628265e-13; -2.15105711e-14; -2.44249065e-15;;
                    3.73393021e-02;  9.88318274e-02;  1.79946014e-01; -6.93306046e-02;
                    -4.15894986e-02;  8.40150023e-03;  3.15338406e-03; -4.39163474e-04;
                    -1.20937778e-04;  1.29096848e-05;  2.81508711e-06; -2.44035109e-07;
                    -4.40969270e-08;  3.22059738e-09;  4.97121667e-10; -3.13800270e-11;
                    -4.22882562e-12;  2.35075848e-13;  2.80678258e-14; -1.43982049e-15;;
                    -3.66618631e-02;  2.21200203e-01; -1.76681292e-01; -1.55172117e-01;
                    4.08349492e-02;  1.88037964e-02; -3.09617289e-03; -9.82912613e-04;
                    1.18743629e-04;  2.88937782e-05; -2.76401358e-06; -5.46186558e-07;
                    4.32968857e-08;  7.20817194e-09; -4.88102510e-10; -7.02331179e-11;
                    4.15216472e-12;  5.26217958e-13; -2.73947531e-14; -3.13638004e-15;;
                    1.37223730e-02;  3.63211715e-02;  6.61310250e-02; -2.54793303e-02;
                    -1.52843406e-02;  3.08759170e-03;  1.15888380e-03; -1.61394687e-04;
                    -4.44452144e-05;  4.74437119e-06;  1.03455804e-06; -8.96840750e-08;
                    -1.62058325e-08;  1.18358501e-09;  1.82694606e-10; -1.15323194e-11;
                    -1.55412488e-12;  8.64031069e-14;  1.02730324e-14; -5.11743425e-16;;
                    -4.15092509e-02;  2.50447030e-01; -2.00041882e-01; -1.75688789e-01;
                    4.62340975e-02;  2.12900119e-02; -3.50554517e-03; -1.11287215e-03;
                    1.34443770e-04;  3.27140791e-05; -3.12946816e-06; -6.18402694e-07;
                    4.90215483e-08;  8.16122781e-09; -5.52638865e-10; -7.95192454e-11;
                    4.70114225e-12;  5.95801186e-13; -3.09474668e-14; -3.58393870e-15;;
                    -2.63869241e-02; -6.98424389e-02; -1.27164182e-01;  4.89945258e-02;
                    2.93904514e-02; -5.93716905e-03; -2.22843228e-03;  3.10347880e-04;
                    8.54642636e-05; -9.12301123e-06; -1.98936471e-06;  1.72454640e-07;
                    3.11623999e-08; -2.27593059e-09; -3.51305767e-10;  2.21756120e-11;
                    2.98841507e-12; -1.66144876e-13; -1.97897254e-14;  1.02348685e-15;;
                    -2.84597065e-02;  1.71712301e-01; -1.37153360e-01; -1.20456314e-01;
                    3.16991710e-02;  1.45969266e-02; -2.40348319e-03; -7.63010990e-04;
                    9.21777712e-05;  2.24295324e-05; -2.14563605e-06; -4.23991249e-07;
                    3.36103120e-08;  5.59552731e-09; -3.78902054e-10; -5.45202668e-11;
                    3.22319255e-12;  4.08409417e-13; -2.11913820e-14; -2.48585874e-15;;
                    -6.30534116e-02; -1.66893421e-01; -3.03867760e-01;  1.17075866e-01;
                    7.02305513e-02; -1.41872832e-02; -5.32499570e-03;  7.41598093e-04;
                    2.04222871e-04; -2.18000772e-05; -4.75372693e-06;  4.12092494e-07;
                    7.44647469e-08; -5.43849621e-09; -8.39469898e-10;  5.29901747e-11;
                    7.14097531e-12; -3.97015754e-13; -4.72955008e-14;  2.39391840e-15;;
                    1.16324708e-02; -7.01847829e-02;  5.60593433e-02;  4.92346804e-02;
                    -1.29565525e-02; -5.96627104e-03;  9.82387080e-04;  3.11869100e-04;
                    -3.76762576e-05; -9.16772914e-06;  8.76995998e-07;  1.73299954e-07;
                    -1.37377023e-08; -2.28708639e-09;  1.54870351e-10;  2.22842899e-11;
                    -1.31743921e-12; -1.67012237e-13;  8.72912853e-15;  9.80118764e-16;;
                    -4.43198275e-02; -1.17308286e-01; -2.13586646e-01;  8.22918549e-02;
                    4.93645917e-02; -9.97214783e-03; -3.74290438e-03;  5.21264412e-04;
                    1.43546910e-04; -1.53231306e-05; -3.34136333e-06;  2.89657098e-07;
                    5.23407798e-08; -3.82268313e-09; -5.90057912e-10;  3.72464247e-11;
                    5.01934605e-12; -2.79096191e-13; -3.32095462e-14;  1.68962067e-15;;
                    4.60753373e-02; -2.77996619e-01;  2.22046821e-01;  1.95014847e-01;
                    -5.13199248e-02; -2.36319485e-02;  3.89116095e-03;  1.23528993e-03;
                    -1.49232808e-04; -3.63126820e-05;  3.47371484e-06;  6.86428015e-07;
                    -5.44139999e-08; -9.05897641e-09;  6.13429973e-10;  8.82664740e-11;
                    -5.21817312e-12; -6.61332100e-13;  3.44446693e-14;  3.94823063e-15;;
                    4.47229450e-02;  1.18375281e-01;  2.15529355e-01; -8.30403527e-02;
                    -4.98135946e-02;  1.00628510e-02;  3.77694853e-03; -5.26005650e-04;
                    -1.44852562e-04;  1.54625044e-05;  3.37175519e-06; -2.92291718e-07;
                    -5.28168532e-08;  3.85745291e-09;  5.95424767e-10; -3.75852752e-11;
                    -5.06502479e-12;  2.81580315e-13;  3.35634298e-14; -1.65839564e-15;;
                    4.99989117e-03; -3.01669596e-02;  2.40955357e-02;  2.11621459e-02;
                    -5.56901053e-03; -2.56443420e-03;  4.22251522e-04;  1.34048182e-04;
                    -1.61940822e-05; -3.94049113e-06;  3.76952122e-07;  7.44881225e-08;
                    -5.90476580e-09; -9.83039967e-10;  6.65666877e-11;  9.57826483e-12;
                    -5.66286601e-13; -7.17325505e-14;  3.70189990e-15;  4.41053444e-16;;
                    5.59958927e-02;  1.48213172e-01;  2.69856080e-01; -1.03971657e-01;
                    -6.23697008e-02;  1.25993117e-02;  4.72897311e-03; -6.58591601e-04;
                    -1.81364365e-04;  1.93600116e-05;  4.22164600e-06; -3.65967305e-07;
                    -6.61299662e-08;  4.82976958e-09;  7.45508688e-10; -4.70590684e-11;
                    -6.34175351e-12;  3.52551321e-13;  4.20080637e-14; -2.13370988e-15;;
                    -5.43412610e-02;  3.27869262e-01; -2.61882060e-01; -2.30000545e-01;
                    6.05267284e-02;  2.78715243e-02; -4.58923592e-03; -1.45690116e-03;
                    1.76005200e-04;  4.28271836e-05; -4.09689990e-06; -8.09573323e-07;
                    6.41758812e-08;  1.06841583e-08; -7.23479519e-10; -1.04101582e-10;
                    6.15428541e-12;  7.79959430e-13; -4.06896739e-14; -4.62130334e-15;;
                    -8.40268562e-02; -2.22407149e-01; -4.04943237e-01;  1.56018790e-01;
                    9.35913266e-02; -1.89063965e-02; -7.09624803e-03;  9.88275730e-04;
                    2.72153486e-04; -2.90514328e-05; -6.33495823e-06;  5.49166744e-07;
                    9.92339419e-08; -7.24750223e-09; -1.11870260e-09;  7.06163114e-11;
                    9.51624890e-12; -5.29076782e-13; -6.29774011e-14;  3.17107451e-15;;
                    4.65783526e-02; -2.81031573e-01;  2.24470958e-01;  1.97143870e-01;
                    -5.18801965e-02; -2.38899441e-02;  3.93364167e-03;  1.24877588e-03;
                    -1.50862017e-04; -3.67091161e-05;  3.51163821e-06;  6.93921911e-07;
                    -5.50080504e-08; -9.15787533e-09;  6.20127050e-10;  8.92301372e-11;
                    -5.27511368e-12; -6.68534672e-13;  3.48610030e-14;  3.97945565e-15;;
                    5.09954538e-02;  1.34977721e-01;  2.45757905e-01; -9.46869771e-02;
                    -5.68000802e-02;  1.14741919e-02;  4.30667533e-03; -5.99779304e-04;
                    -1.65168509e-04;  1.76311606e-05;  3.84465259e-06; -3.33286387e-07;
                    -6.02245535e-08;  4.39847063e-09;  6.78934693e-10; -4.28566072e-11;
                    -5.77546344e-12;  3.21145888e-13;  3.81500387e-14; -1.91860416e-15;;
                    -2.18748237e-02;  1.31982257e-01; -1.05419414e-01; -9.25856573e-02;
                    2.43647551e-02;  1.12195534e-02; -1.84737573e-03; -5.86468835e-04;
                    7.08500806e-05;  1.72398850e-05; -1.64918814e-06; -3.25890003e-07;
                    2.58337046e-08;  4.30085866e-09; -2.91233294e-10; -4.19056161e-11;
                    2.47740717e-12;  3.13971071e-13; -1.63896674e-14; -1.86656246e-15;;
                    -1.94614349e-02; -5.15116531e-02; -9.37887817e-02;  3.61354652e-02;
                    2.16766591e-02; -4.37890482e-03; -1.64355988e-03;  2.28894245e-04;
                    6.30333872e-05; -6.72859363e-06; -1.46723778e-06;  1.27192345e-07;
                    2.29835435e-08; -1.67859177e-09; -2.59102349e-10;  1.63554240e-11;
                    2.20410495e-12; -1.22533927e-13; -1.46133106e-14;  7.35522754e-16;;
                    6.99889336e-03; -4.22279857e-02;  3.37291511e-02;  2.96229652e-02;
                    -7.79555184e-03; -3.58971843e-03;  5.91071539e-04;  1.87641870e-04;
                    -2.26686242e-05; -5.51593550e-06;  5.27661025e-07;  1.04269155e-07;
                    -8.26554515e-09; -1.37606830e-09;  9.31806780e-11;  1.34078165e-11;
                    -7.92661076e-13; -1.00423142e-13;  5.20070098e-15;  6.04117451e-16;;
                    5.33566892e-03;  1.41227575e-02;  2.57137199e-02; -9.90712551e-03;
                    -5.94300864e-03;  1.20054798e-03;  4.50608672e-04; -6.27550802e-05;
                    -1.72816283e-05;  1.84475338e-06;  4.02267100e-07; -3.48718500e-08;
                    -6.30131230e-09;  4.60213227e-10;  7.10371188e-11; -4.48410710e-12;
                    -6.04214595e-13;  3.36380229e-14;  3.98379246e-15; -2.09901541e-16;;
                    -1.67122953e-03;  1.00834022e-02; -8.05400947e-03; -7.07351457e-03;
                    1.86145949e-03;  8.57170288e-04; -1.41138914e-04; -4.48060312e-05;
                    5.41292347e-06;  1.31712169e-06; -1.25997446e-07; -2.48978919e-08;
                    1.97368678e-09;  3.28584191e-10; -2.22501628e-11; -3.20155773e-12;
                    1.89271775e-13;  2.40042361e-14; -1.22384741e-15; -1.51788304e-16;;
                    -1.12379157e-03; -2.97451661e-03; -5.41578986e-03;  2.08662574e-03;
                    1.25170866e-03; -2.52857835e-04; -9.49066056e-05;  1.32173924e-05;
                    3.63983382e-06; -3.88539530e-07; -8.47249673e-08;  7.34466326e-09;
                    1.32717406e-09; -9.69295125e-11; -1.49617689e-11;  9.44391809e-13;
                    1.27321331e-13; -7.07940651e-15; -8.50665025e-16;  4.66206934e-17;;
                    3.13650769e-04; -1.89241920e-03;  1.51154956e-03;  1.32753356e-03;
                    -3.49352491e-04; -1.60870853e-04;  2.64884794e-05;  8.40904609e-06;
                    -1.01587937e-06; -2.47192995e-07;  2.36467793e-08;  4.67275305e-09;
                    -3.70414903e-10; -6.16675576e-11;  4.17581445e-12;  6.00883736e-13;
                    -3.55069706e-14; -4.50063164e-15;  2.76471554e-16;  1.49619900e-17;;
                    1.89522537e-04;  5.01639228e-04;  9.13349294e-04; -3.51900313e-04;
                    -2.11095196e-04;  4.26433691e-05;  1.60055843e-05; -2.22905548e-06;
                    -6.13842069e-07;  6.55254940e-08;  1.42884955e-08; -1.23864532e-09;
                    -2.23822115e-10;  1.63467490e-11;  2.52322006e-12; -1.59306040e-13;
                    -2.14301775e-14;  1.17625094e-15;  1.25767452e-16;  8.02309608e-18;;
                    -4.78699312e-05;  2.88824342e-04; -2.30695349e-04; -2.02610503e-04;
                    5.33187907e-05;  2.45523921e-05; -4.04271825e-06; -1.28340338e-06;
                    1.55045294e-07;  3.77270290e-08; -3.60901298e-09; -7.13163778e-10;
                    5.65334017e-11;  9.41182528e-12; -6.37325038e-13; -9.16781909e-14;
                    5.42811239e-15;  6.62149372e-16;  2.43403388e-17; -4.66206934e-18;;
                    -2.63362529e-05; -6.97083193e-05; -1.26919987e-04;  4.89004408e-05;
                    2.93340124e-05; -5.92576781e-06; -2.22415298e-06;  3.09751914e-07;
                    8.53001452e-08; -9.10549214e-09; -1.98554452e-09;  1.72123488e-10;
                    3.11025755e-11; -2.27155670e-12; -3.50589028e-13;  2.21502978e-14;
                    2.98681097e-15; -1.67753181e-16;  4.21483595e-18;  3.90312782e-18;;
                    6.08865033e-06; -3.67360133e-05;  2.93424970e-05;  2.57703422e-05;
                    -6.78169917e-06; -3.12285660e-06;  5.14199565e-07;  1.63238054e-07;
                    -1.97204499e-08; -4.79855896e-09;  4.59035895e-10;  9.07083746e-11;
                    -7.19054694e-12; -1.19703981e-12;  8.10918812e-14;  1.16999899e-14;
                    -7.13618482e-16; -8.31481422e-17;  1.95258035e-17;  1.14925430e-17;;
                    3.08026024e-06;  8.15301119e-06;  1.48444272e-05; -5.71934376e-06;
                    -3.43087502e-06;  6.93071526e-07;  2.60134577e-07; -3.62282557e-08;
                    -9.97661462e-09;  1.06496869e-09;  2.32227111e-10; -2.01313972e-11;
                    -3.63770033e-12;  2.65738594e-13;  4.10709088e-14; -2.56145791e-15;
                    -3.15545184e-16;  2.61013203e-17; -7.69360026e-18; -5.09575021e-18;;
                    -6.57525352e-07;  3.96719450e-06; -3.16875410e-06; -2.78299006e-06;
                    7.32369064e-07;  3.37243441e-07; -5.55294247e-08; -1.76283993e-08;
                    2.12965026e-09;  5.18205827e-10; -4.95722497e-11; -9.79580155e-12;
                    7.76543678e-13;  1.29308262e-13; -8.71592159e-15; -1.22439661e-15;
                    8.88524856e-17;  1.53778832e-18; -1.10160870e-17; -1.19262239e-17;;
                    -3.08270155e-07; -8.15947300e-07; -1.48561924e-06;  5.72387672e-07;
                    3.43359422e-07; -6.93620831e-08; -2.60340751e-08;  3.62569688e-09;
                    9.98452146e-10; -1.06581263e-10; -2.32411163e-11;  2.01471337e-12;
                    3.64069632e-13; -2.65750614e-14; -4.09980444e-15;  2.79946930e-16;
                    3.48510647e-17; -2.26034977e-17;  4.50250951e-18; -9.52742659e-18;;
                    6.11851039e-08; -3.69161747e-07;  2.94863990e-07;  2.58967256e-07;
                    -6.81495810e-08; -3.13817176e-08;  5.16721310e-09;  1.64038610e-09;
                    -1.98171638e-10; -4.82208876e-11;  4.61288656e-12;  9.11541933e-13;
                    -7.22717211e-14; -1.20474774e-14;  8.35252102e-16;  1.00545656e-16;
                    1.27374962e-17;  2.43358124e-17;  5.14101353e-18;  5.09575021e-18;;
                    2.67519968e-08;  7.08087345e-08;  1.28923545e-07; -4.96723829e-08;
                    -2.97970790e-08;  6.01931195e-09;  2.25926344e-09; -3.14641648e-10;
                    -8.66466843e-11;  9.24926549e-12;  2.01690985e-12; -1.74837705e-13;
                    -3.15909424e-14;  2.28338099e-15;  3.59473036e-16; -3.94246522e-17;
                    -4.72084946e-17;  1.26574516e-18;  2.64644989e-17;  1.08420217e-19;;
                    -4.96534422e-09;  2.99585198e-08; -2.39290467e-08; -2.10159252e-08;
                    5.53053126e-09;  2.54671512e-09; -4.19333965e-10; -1.33121984e-10;
                    1.60821871e-11;  3.91327100e-12; -3.74345797e-13; -7.39586235e-14;
                    5.84473205e-15;  9.70149653e-16; -6.10402796e-17; -4.65166581e-17;
                    -1.61687969e-17; -9.68862424e-18; -1.45891102e-17;  1.07336015e-17;;
                    -2.03529227e-09; -5.38712953e-09; -9.80850499e-09;  3.77907559e-09;
                    2.26696213e-09; -4.57949416e-10; -1.71884810e-10;  2.39379771e-11;
                    6.59204760e-12; -7.03709889e-13; -1.53466875e-13;  1.32700878e-14;
                    2.38268845e-15; -1.88327069e-16; -4.28491319e-17;  6.19072455e-18;
                    -1.32121341e-17;  1.12761857e-17; -3.40351561e-17; -1.03270257e-17;;
                    3.54967238e-10; -2.14170256e-09;  1.71066245e-09;  1.50240600e-09;
                    -3.95371913e-10; -1.82061995e-10;  2.99777427e-11;  9.51675183e-12;
                    -1.14972032e-12; -2.79794441e-13;  2.67499975e-14;  5.29835901e-15;
                    -4.46914871e-16; -8.83292958e-17; -2.25531774e-17; -2.49203076e-17;
                    2.09634645e-17;  1.83726977e-17; -3.60709593e-17;  5.85469173e-18;;
                    1.37012208e-10;  3.62651429e-10;  6.60290878e-10; -2.54400302e-10;
                    -1.52607803e-10;  3.08282569e-11;  1.15709698e-11; -1.61145100e-12;
                    -4.43780428e-13;  4.73708647e-14;  1.03369322e-14; -8.71307104e-16;
                    -1.84193320e-16; -8.70650111e-18; -1.59121392e-17;  2.92512807e-18;
                    -6.48292491e-19;  1.27092481e-17; -1.98229073e-17;  5.36680075e-18;;
                    -2.25462856e-11;  1.36032912e-10; -1.08655285e-10; -9.54272046e-11;
                    2.51126388e-11;  1.15638625e-11; -1.90406470e-12; -6.04429468e-13;
                    7.30174759e-14;  1.77450324e-14; -1.65464517e-15; -3.17499087e-16;
                    2.49848083e-17; -1.53803727e-17; -4.06793909e-17;  1.32805378e-17;
                    1.20796635e-17;  3.82887879e-17; -2.89131213e-17; -4.33680869e-18;;
                    -8.22612703e-12; -2.17733614e-11; -3.96434506e-11;  1.52740762e-11;
                    9.16251316e-12; -1.85088376e-12; -6.94710359e-13;  9.67497118e-14;
                    2.66375390e-14; -2.84884631e-15; -5.96123630e-16;  6.20434092e-17;
                    8.88472919e-18;  4.91247365e-18;  1.87918356e-17; -2.14266021e-17;
                    8.82289611e-18; -2.38437545e-17;  1.08430057e-17; -1.08420217e-18;;
                    1.28178750e-12; -7.73308193e-12;  6.17719864e-12;  5.42475225e-12;
                    -1.42763504e-12; -6.57348342e-13;  1.08245086e-13;  3.43597733e-14;
                    -4.17747029e-15; -9.93725456e-16;  8.73405181e-17;  2.26776801e-17;
                    1.79062347e-17; -5.97014386e-18;  2.58195826e-17;  2.79844237e-17;
                    -1.15790651e-17;  1.76807525e-17;  1.73942226e-17; -1.42030485e-17;;
                    4.43456578e-13;  1.17382615e-12;  2.13719783e-12; -8.23438555e-13;
                    -4.93952032e-13;  9.97903676e-14;  3.74798259e-14; -5.20882236e-15;
                    -1.42324671e-15;  1.21973853e-16;  4.62750811e-17;  3.78270524e-18;
                    -3.78281451e-18;  9.01908320e-18; -1.03887466e-17;  2.00346109e-17;
                    3.00580922e-17;  1.01088520e-17; -7.47030382e-18;  1.20346441e-17;;
                    -6.56681740e-14;  3.95864931e-13; -3.16551368e-13; -2.77678490e-13;
                    7.31438256e-14;  3.37027315e-14; -5.57876492e-15; -1.78908480e-15;
                    1.99466853e-16;  8.83116610e-17;  2.12951083e-17; -3.10712871e-17;
                    7.76068018e-18;  1.05960391e-18; -1.71968042e-18; -1.54783149e-17;
                    3.06399599e-17; -1.32173487e-17;  3.52209881e-17; -6.28837260e-18;;
                    -2.17006317e-14; -5.74776737e-14; -1.04599916e-13;  4.03179157e-14;
                    2.41529760e-14; -4.91423131e-15; -1.83970880e-15;  2.42273240e-16;
                    9.52277722e-17;  1.88663153e-17; -4.12873995e-18; -1.58428057e-17;
                    1.01037895e-17; -1.51542681e-17; -3.05459800e-17;  2.01218598e-17;
                    -3.91802196e-17;  1.98783667e-18;  2.34252406e-17; -7.91467586e-18;;
                    2.95369198e-15; -1.78146579e-14;  1.41804386e-14;  1.24857646e-14;
                    -3.32826425e-15; -1.54763729e-15;  2.41704017e-16;  6.29998429e-17;
                    3.42356256e-17; -3.03722802e-17; -1.96223880e-17; -4.31566314e-18;
                    -1.44600516e-17;  1.70077529e-17; -1.06254713e-17; -1.79694690e-17;
                    -5.40209546e-17; -3.08412860e-17;  9.51678124e-20;  1.61546124e-17;;
                    9.18210820e-16;  2.72974382e-15;  4.40756179e-15; -1.91607157e-15;
                    -1.04326463e-15;  2.39592143e-16;  4.27662140e-17; -2.65367529e-17;
                    -5.25857538e-18;  5.06907017e-18; -1.23852289e-17; -2.53777332e-17;
                    1.53689204e-17;  5.02569613e-19;  4.22516209e-18; -2.20401194e-17;
                    -3.32089439e-17; -2.88861646e-17;  3.50411152e-17;  2.92734587e-18]
        transformed_coeffs_10 = transformChebInPlace1D(coeffs_10,alpha_10,beta_10)
        @test ((20,48) == size(transformed_coeffs_10))
        @test isapprox(transformed_coeffs_10[11,1], -0.00000287423045388161)
        @test isapprox(transformed_coeffs_10[20,1], -0.00000000000000133806,atol=2^-52)
        @test isapprox(transformed_coeffs_10[9,5], 0.00027335694312178378)
        @test isapprox(transformed_coeffs_10[10,48], 0,atol=2^-52)
    end
end

function test_transformChebInPlaceND()
    @testset "transformChebInPlaceND unit tests" begin
        alpha_1 = 0.8043138619259216
        beta_1 = 0.19568613807407842
        dim_1 = 0
        coeffs_1 = [1.6668764854819471; 0.502737971117991; 0.003441591526151544;;0.5575078290711436; 0; 0;; 0.01239107183457752; 0.0; 0.0;;;
                            -1.20687653838567; 0; 0;; 0; 0; 0;;0.0; 0.0; 0.0;;;
                            -0.018876295666785736; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_1 = [ 1.43592664172332273864;  0.50273797111799101156;  0.00344159152615154413;;
                                                     0.55750782907114360132;  0.;          0.;;
                                                     0.01239107183457751997;  0.;          0.;;;
                                                    -0.98259152221737600108;  0.;          0.;;
                                                     0.;          0.;          0.;;
                                                     0.;          0.;          0.;;;
                                                    -0.01221146807645548740;  0.;          0.;;
                                                     0.;          0.;          0.;;
                                                     0.;          0.;          0.        ]
        transformed_coeffs_1 = TransformChebInPlaceND(coeffs_1,dim_1,alpha_1,beta_1,false)
        @test isapprox(expected_transformed_coeffs_1,transformed_coeffs_1)

        alpha_2 = 0.561531793052032
        beta_2 = -0.43846820694796795
        dim_2 = 0
        coeffs_2 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_2 = [ 1.66687648548194711218; -1.20687653838567010567; -0.01887629566678573553 ;;
                                                 0.55750782907114360132;  0.;          0.;;
                                                 0.01239107183457751997;  0.;          0.;;;
                                                 0.50273797111799101156;  0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.;;;
                                                 0.00344159152615154413;  0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.        ]
        transformed_coeffs_2 = TransformChebInPlaceND(coeffs_2,dim_2,alpha_2,beta_2,false)
        @test isapprox(expected_transformed_coeffs_2,transformed_coeffs_2)
        
        alpha_3 = 0.561531793052032
        beta_3 = 0
        dim_3 = 0
        coeffs_3 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_3 =  [2.06363273035505034869; -1.20687653838567010567; -0.01887629566678573553;;
                                                 0.55750782907114360132;  0.;          0.;;
                                                 0.01239107183457751997;  0.;          0.;;;
                                                 0.51348734263490647400;  0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.;;;
                                                 0.00344159152615154413;  0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.]
        transformed_coeffs_3 = TransformChebInPlaceND(coeffs_3,dim_3,alpha_3,beta_3,false)
        @test isapprox(expected_transformed_coeffs_3,transformed_coeffs_3)
        
        alpha_4 = 0
        beta_4 = -0.43846820694796795
        dim_4 = 0
        coeffs_4 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_4 =  [1.66343489395579569035; -1.20687653838567010567; -0.01887629566678573553 ;;
                                                 0.55750782907114360132;  0.;          0.;;
                                                 0.01239107183457751997;  0.;          0.;;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.]
        transformed_coeffs_4 = TransformChebInPlaceND(coeffs_4,dim_4,alpha_4,beta_4,false)
        @test isapprox(expected_transformed_coeffs_4,transformed_coeffs_4)
        
        alpha_5 = 0
        beta_5 = 0
        dim_5 = 0
        coeffs_5 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_5 =  [2.06019113882889870482; -1.20687653838567010567; -0.01887629566678573553 ;;
                                                     0.55750782907114360132;  0.;          0.;;
                                                     0.01239107183457751997;  0.;          0.;;;
                                                     0.;          0.;          0.;;
                                                     0.;          0.;          0.;;
                                                     0.;          0.;          0.]
        transformed_coeffs_5 = TransformChebInPlaceND(coeffs_5,dim_5,alpha_5,beta_5,false)
        @test isapprox(expected_transformed_coeffs_5,transformed_coeffs_5)
        
        alpha_6 = 1.000000082740371e-10
        beta_6 = -0.7266187050359711
        coeffs_6 = [10.1; 13.9]
        dim_6 = 0
        expected_transformed_coeffs_6 = [0.00000000000000000000; 0.00000000139000011501]
        transformed_coeffs_6 = TransformChebInPlaceND(coeffs_6,dim_6,alpha_6,beta_6,false)
        @test isapprox(expected_transformed_coeffs_6,transformed_coeffs_6)

        alpha_7 = 1
        beta_7 = 0
        coeffs_7 = [10.1; 13.9]
        dim_7 = 0
        expected_transformed_coeffs_7 = [10.1; 13.9]
        transformed_coeffs_7 = TransformChebInPlaceND(coeffs_7,dim_7,alpha_7,beta_7,false)
        @test isapprox(expected_transformed_coeffs_7,transformed_coeffs_7)

        alpha_8 = 0.561531793052032
        beta_8 = -0.43846820694796795
        dim_8 = 1
        coeffs_8 = [2.071105809166741; -1.20687653838567; -0.018876295666785736;;0.5575078290711436; 0; 0;;0.01239107183457752; 0.0; 0.0;;;
                        0.9144403736144754; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0;;;
                        0.010914670337842268; 0; 0;;0; 0; 0;;0.0; 0.0; 0.0]
        expected_transformed_coeffs_8 =  [1.82293688196746050956; -1.20687653838567010567; -0.01887629566678573553 ;;
                                                 0.30085495746356821778;  0.;          0.;;
                                                 0.00390712742628263315;  0.;          0.;;;
                                                 0.91444037361447538803;  0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.;;;
                                                 0.01091467033784226763;  0.;          0.;;
                                                 0.;          0.;          0.;;
                                                 0.;          0.;          0.]
        transformed_coeffs_8 = TransformChebInPlaceND(coeffs_8,dim_8,alpha_8,beta_8,false)
        @test isapprox(expected_transformed_coeffs_8,transformed_coeffs_8)

        alpha_9 = 1.2837492384
        beta_9 = .7234444321123415
        dim_9 = 4
        coeffs_9 = reshape(collect(0:4*2*4*3*4*3-1),(3,4,3,4,2,4))
        transformed_coeffs_9 = TransformChebInPlaceND(coeffs_9,dim_9,alpha_9,beta_9,false)
        @test isapprox(transformed_coeffs_9[3,4,3,4,2,4], 2435.0950647445447)
        @test isapprox(transformed_coeffs_9[1,1,1,1,1,1], 70.81780444042236410951)
        @test isapprox(transformed_coeffs_9[1,2,1,1,1,1], 121.16430035593349145984)
        @test isapprox(transformed_coeffs_9[1,2,1,1,1,2], 4601.53072119819717045175)
        @test isapprox(transformed_coeffs_9[1,2,1,1,1,2], 4601.53072119819717045175)
        @test isapprox(transformed_coeffs_9[1,2,1,3,2,4], 16922.53837851442222017795)
        @test isapprox(transformed_coeffs_9[1,2,1,3,2,3], 12442.17195767216071544681)

        alpha_10 = 1.2837492384
        beta_10 = .7234444321123415
        dim_10 = 2
        coeffs_10 = reshape(collect(0:4*2*4*3*4*3-1),(3,4,3,4,2,4))   
        transformed_coeffs_10 = TransformChebInPlaceND(coeffs_10,dim_10,alpha_10,beta_10,false)
        @test isapprox(2435.09506474454474300728,transformed_coeffs_10[3,4,3,4,2,4])
        @test isapprox(849.81365328506842615752,transformed_coeffs_10[1,1,1,1,1,1])
        @test isapprox(879.56123276256857934641,transformed_coeffs_10[1,2,1,1,1,1])
        @test isapprox(3735.32886260257600952173,transformed_coeffs_10[1,2,1,1,1,2])
        @test isapprox(9789.53127017231054196600,transformed_coeffs_10[1,2,1,3,2,4])
        @test isapprox(7254.70410722685846849345,transformed_coeffs_10[1,2,1,3,2,3])
        @test isapprox(8423.43048113694567291532,transformed_coeffs_10[2,2,2,2,2,2])
        @test isapprox(5981.00850866390646842774,transformed_coeffs_10[1,2,1,2,1,2])
        @test isapprox(2361.04786468715201408486,transformed_coeffs_10[1,1,1,4,2,4])
        @test isapprox(7536.35156977635233488400,transformed_coeffs_10[3,4,3,3,2,3])

        alpha_11 = 3.456654
        beta_11 = .451324
        dim_11 = 2
        coeffs_11 = reshape(collect(0:3*2*1*2-1),(2,1,2,3))
        expected_transformed_coeffs_11 = coeffs_11
        transformed_coeffs_11 = TransformChebInPlaceND(coeffs_11,dim_11,alpha_11,beta_11,false)
        @test isapprox(transformed_coeffs_11,expected_transformed_coeffs_11)
    end
end

function test_getTransformationError()
    @testset "getTransformationError unit tests" begin
        M_1 = [0; -.939093750; 0; -.0138146058; -.00106830799; -.0137307266;;
                0; -1.05695980; 0; -.0149230031; .00237984138; -.0298460061;;
                0; 0;  0;  0; 0; 0;;
                0; -1.63828770; 0; -1.63828770; -.00611697632; -.00852711940;;
                0; 0; 0; 0; 0; 0;;
                0; 0;  0;  0.0; 0.0; 0.0]
        dim_1a = 0
        dim_1b = 1
        expected_error_1a = 0.00000000000000714500
        expected_error_1b = 0.00000000000000714500
        @test isapprox(expected_error_1a,getTransformationError(M_1,dim_1a),atol = 2^-52)
        @test isapprox(expected_error_1b,getTransformationError(M_1,dim_1b),atol = 2^-52)

        M_2 = [-1.09679818; -.939093750; -.921375000; -.0138146058; -.00106830799; -.0137307266;;
                .915137070; -1.05695980; -1.03701717; -.0149230031; .00237984138; -.0298460061;;
                .000607404435; -.00309112001;  .000675877264;  .0750781250; -1.10873059; -.0379851973;;
                1.42079568; -1.63828770; -1.60737661; -1.63828770; -.00611697632; -.00852711940;;
                .901029633; -.240222558; -1.16359475; -1.12860484; -.0167700634; -1.01490072;;
                .310991071; -1.58265345;  .346049159;  0.0; 0.0; 0.0]
        dim_2a = 0
        dim_2b = 1
        expected_error_2a = 0.00000000000002703507
        expected_error_2b = 0.00000000000002703507
        @test isapprox(expected_error_2a,getTransformationError(M_2,dim_2a),atol = 2^-52)
        @test isapprox(expected_error_2b,getTransformationError(M_2,dim_2b),atol = 2^-52)

        M_3 = reshape(collect(0:4*2*4*3*4*3-1),(3,4,3,4,2,4))
        dim_3a = 0
        dim_3b = 1
        dim_3c = 2
        dim_3d = 3
        dim_3e = 4
        dim_3f = 5
        expected_error_3a = 0.00000000058884097598
        expected_error_3b = 0.00000000029442048799
        expected_error_3c = 0.00000000058884097598
        expected_error_3d = 0.00000000044163073198
        expected_error_3e = 0.00000000058884097598
        expected_error_3f = 0.00000000044163073198
        @test isapprox(expected_error_3a,getTransformationError(M_3,dim_3a))
        @test isapprox(expected_error_3b,getTransformationError(M_3,dim_3b))
        @test isapprox(expected_error_3c,getTransformationError(M_3,dim_3c))
        @test isapprox(expected_error_3d,getTransformationError(M_3,dim_3d))
        @test isapprox(expected_error_3e,getTransformationError(M_3,dim_3e))
        @test isapprox(expected_error_3f,getTransformationError(M_3,dim_3f))

        M_4 = [10.1; 13.9]
        dim_4 = 0
        expected_error_4 = 0.00000000000001065814
        @test isapprox(expected_error_4,getTransformationError(M_4,dim_4),atol = 2^-52)

        M_5 = reshape(collect(0:3*2*1*2-1),(2,1,2,3))
        dim_5a = 0
        dim_5b = 1
        dim_5c = 2
        expected_error_5a = 0.00000000000004396483
        expected_error_5b = 0.00000000000002930989
        expected_error_5c = 0.00000000000001465494
        @test isapprox(expected_error_5a,getTransformationError(M_5,dim_5a),atol = 2^-52)
        @test isapprox(expected_error_5b,getTransformationError(M_5,dim_5b),atol = 2^-52)
        @test isapprox(expected_error_5c,getTransformationError(M_5,dim_5c),atol = 2^-52)
    end
end

function test_transformCheb()
    @testset "test_transformCheb unit tests" begin
        M_1 = [-4.51013026e-01;  9.19663154e-02;  3.28195239e-03; -1.11200236e-04;
                        -1.98249324e-06;  4.02883056e-08;  4.78752802e-10; -6.94867420e-12;
                        -6.19244882e-14;  6.99276156e-16;;
                         7.27945065e-01;  1.04163259e-01; -5.29714422e-03; -1.25948060e-04;
                        3.19978823e-06;  4.56315034e-08; -7.72717627e-10; -7.87022401e-12;
                        9.99484941e-14;  7.91457512e-16;;
                         1.81446642e-01; -3.69988851e-02; -1.32035929e-03;  4.47368662e-05;
                        7.97575060e-07; -1.62083517e-08; -1.92606607e-10;  2.79551450e-12;
                        2.49127467e-14; -2.81327865e-16;;
                        -4.17559211e-02; -5.97494652e-03;  3.03851412e-04;  7.22455238e-06;
                        -1.83544214e-07; -2.61748523e-09;  4.43241362e-11;  4.51446745e-13;
                        -5.73318646e-15; -4.53994547e-17;;
                        -5.00176929e-03;  1.01991354e-03;  3.63971055e-05; -1.23321921e-06;
                        -2.19860032e-08;  4.46800419e-10;  5.30940553e-12; -7.70612943e-14;
                        -6.86741392e-16;  7.75549577e-18;;
                         6.79328350e-04;  9.72065866e-05; -4.94336787e-06; -1.17536462e-07;
                        2.98608640e-09;  4.25839466e-11; -7.21110716e-13; -7.34459600e-15;
                        9.32741098e-17;  7.38663524e-19;;
                         5.37888317e-05; -1.09681104e-05; -3.91413052e-07;  1.32619912e-08;
                        2.36436622e-10; -4.80487396e-12; -5.70971172e-14;  8.28713695e-16;
                        7.38494412e-18; -8.34261085e-20;;
                        -5.19217396e-06; -7.42959583e-07;  3.77826509e-08;  8.98342840e-10;
                        -2.28229544e-11; -3.25473312e-13;  5.51152192e-15;  5.61354057e-17;
                        -7.12925819e-19; -5.64783855e-21;;
                        -3.07353268e-07;  6.26725748e-08;  2.23656244e-09; -7.57799754e-11;
                        -1.35101600e-12;  2.74553819e-14;  3.26255769e-16; -4.73534687e-18;
                        -4.21905144e-20;  4.77555404e-22;;
                         2.30256366e-08;  3.29478896e-09; -1.67554015e-10; -3.98386405e-12;
                        1.01212572e-13;  1.44337509e-15; -2.44422320e-17; -2.49106366e-19;
                        3.14036001e-21;  2.34621142e-23;;
                         1.08873955e-09; -2.22005488e-10; -7.92259018e-12;  2.68435894e-13;
                        4.78570299e-15; -9.72564379e-17; -1.15559028e-18;  1.68156727e-20;
                        1.54803735e-22; -1.29305190e-24;;
                        -6.66587822e-11; -9.53835256e-12;  4.85065600e-13;  1.15330485e-14;
                        -2.93067929e-16; -4.18555482e-18;  7.11281170e-20;  9.22967944e-22;
                        1.80694558e-23;  1.99028925e-24;;
                        -2.62432122e-12;  5.35142174e-13;  1.90967049e-14; -6.47187222e-16;
                        -1.15810253e-17;  2.29061427e-19;  3.06343121e-21;  1.13252742e-22;
                        2.03470643e-23;  1.57395400e-24;;
                         1.35861175e-13;  1.94546693e-14; -9.88671456e-16; -2.35731916e-17;
                        5.79100447e-19;  6.38400554e-21; -3.33430711e-23;  5.97844983e-23;
                        8.27048604e-24;  6.25702768e-25;;
                         4.57944806e-15; -9.28412384e-16; -3.33314540e-17;  1.11036002e-18;
                        1.56847510e-20; -9.31871766e-22;  2.24091259e-23;  1.51210497e-23;
                        2.02797620e-24;  1.53675674e-25]
        alphas_1 = [0.96189495661543289451; 1.        ]
        betas_1 = [0.03810504338456710549; 0.        ]
        error_1 = 0.00000000000028849801
        expected_error_1 = 0.00000000000029762757
        expected_M_1 = [-0.43974878832814545682; 0.09790962437138257812; 0.00319998426562025659; -0.00011838653413301305; -0.00000193297964769047; 0.00000004289193115029; 0.00000000046679575372; -0.00000000000739773081; -0.00000000000006037786; 0.00000000000000074445 ;;
                        0.73382406700715940850; 0.09616717824478956955; -0.00533992481250061737; -0.00011627967149287864; 0.00000322563023680718; 0.00000004212860624002; -0.00000000077895822145; -0.00000000000726606662; 0.00000000000010075566; 0.00000000000000073067 ;;
                        0.16042890271866691587; -0.03571933349524124279; -0.00116741643577678196; 0.00004318970799154190; 0.00000070518853532431; -0.00000001564780988304; -0.00000000017029616202; 0.00000000000269883564; 0.00000000000002202698; -0.00000000000000027159 ;;
                        -0.03869481688259344271; -0.00507093120518843643; 0.00028157622771512390; 0.00000613147046166299; -0.00000017008868596417; -0.00000000222145712796; 0.00000000004107475761; 0.00000000000038314238; -0.00000000000000531289; -0.00000000000000003853 ;;        
                        -0.00407823109186094927; 0.00090801404078298925; 0.00002967666013869413; -0.00000109791694474066; -0.00000001792645694906; 0.00000000039777984889; 0.00000000000432906468; -0.00000000000006860653; -0.00000000000000055994; 0.00000000000000000690 ;;
                        0.00058127963246545119; 0.00007617632707219498; -0.00000422988244013509; -0.00000009210791453205; 0.00000000255509902629; 0.00000000003337107873; -0.00000000000061703147; -0.00000000000000575562; 0.00000000000000007981; 0.00000000000000000058 ;;
                        0.00004052235723314688; -0.00000902226198556183; -0.00000029487495861151; 0.00000001090918624004; 0.00000000017812190685; -0.00000000000395244304; -0.00000000000004301469; 0.00000000000000068169; 0.00000000000000000556; -0.00000000000000000007 ;;
                        -0.00000410652300914701; -0.00000053815723510380; 0.00000002988253600122; 0.00000000065070793882; -0.00000000001805081809; -0.00000000000023575418; 0.00000000000000435910; 0.00000000000000004066; -0.00000000000000000056; -0.00000000000000000000 ;;        
                        -0.00000021407455390090; 0.00000004766348362659; 0.00000000155778758975; -0.00000000005763186888; -0.00000000000094099583; 0.00000000000002088025; 0.00000000000000022724; -0.00000000000000000360; -0.00000000000000000003; 0.00000000000000000000 ;;
                        0.00000001683961804348; 0.00000000220682126834; -0.00000000012253930966; -0.00000000000266835780; 0.00000000000007402103; 0.00000000000000096676; -0.00000000000000001788; -0.00000000000000000017; 0.00000000000000000000; 0.00000000000000000000 ;;
                        0.00000000070128897094; -0.00000000015614129252; -0.00000000000510317197; 0.00000000000018879675; 0.00000000000000308259; -0.00000000000000006840; -0.00000000000000000074; 0.00000000000000000001; 0.00000000000000000000; -0.00000000000000000000 ;;
                        -0.00000000004508795998; -0.00000000000590874393; 0.00000000000032809804; 0.00000000000000714434; -0.00000000000000019825; -0.00000000000000000260; 0.00000000000000000005; 0.00000000000000000000; 0.00000000000000000000; 0.00000000000000000000 ;;
                        -0.00000000000156349257; 0.00000000000034813249; 0.00000000000001137723; -0.00000000000000042105; -0.00000000000000000691; 0.00000000000000000015; 0.00000000000000000000; 0.00000000000000000000; 0.00000000000000000000; 0.00000000000000000000 ;;
                        0.00000000000008493743; 0.00000000000001114263; -0.00000000000000061810; -0.00000000000000001351; 0.00000000000000000036; 0.00000000000000000000; -0.00000000000000000000; 0.00000000000000000000; 0.00000000000000000000; 0.00000000000000000000 ;;
                        0.00000000000000265828; -0.00000000000000053892; -0.00000000000000001935; 0.00000000000000000064; 0.00000000000000000001; -0.00000000000000000000; 0.00000000000000000000; 0.00000000000000000000; 0.00000000000000000000; 0.00000000000000000000 ]
        M_1o, error_1o = transformCheb(M_1,alphas_1,betas_1,error_1,false)
        @test isapprox(expected_M_1,M_1o)
        @test isapprox(expected_error_1,error_1o)

        M_2 = [-1.42428995e+00; -4.37529946e-01; -4.90606009e-03;;
                     4.12980070e-01; -5.11290053e-18; -9.88218875e-20;;
                     1.47492882e-02;  1.10826219e-19;  2.22922861e-21;;;

                     7.76288054e-01; -1.01807649e-18; -9.10966739e-21;;
                     6.36918820e-18;  6.16456054e-20;  9.06529547e-21;;
                    -9.68352712e-20; -4.06835665e-21; -2.76670990e-22;;;

                     2.53412195e-02;  2.94136768e-20;  9.60324957e-22;;
                     4.76059766e-20;  1.23291339e-20;  4.02532979e-22;;
                    -1.25194459e-21; -3.24232242e-22; -1.05858345e-23]
        alphas_2 = [0.44122451303066934081; 0.82937977695676190493; 0.01065031960613682660]
        betas_2 = [0.55877548696933065919; 0.17062022304323809507; -0.98934968039386317340]
        error_2 = 0.00000000000022718514
        expected_error_2 = 0.00000000000023213989
        expected_M_2 = [-0.50021325263737104194; -0.00445305529429256258; -0.00000055649099960640 ;;
                        0.35086594422925271308; -0.00000000000000000004; -0.00000000000000000000 ;;
                        0.01014560488632080225; 0.00000000000000000000; 0.00000000000000000000 ;;;
                        0.36750836726079333383; -0.00000000000000000000; -0.00000000000000000000 ;;
                        0.00000000000000000232; 0.00000000000000000000; 0.00000000000000000000 ;;
                        -0.00000000000000000003; -0.00000000000000000000; -0.00000000000000000000 ;;;
                        0.00493340506771145545; 0.00000000000000000000; 0.00000000000000000000 ;;
                        0.00000000000000000001; 0.00000000000000000000; 0.00000000000000000000 ;;
                        -0.00000000000000000000; -0.00000000000000000000; -0.00000000000000000000 ]
        M_2o, error_2o = transformCheb(M_2,alphas_2,betas_2,error_2,false)
        @test isapprox(expected_M_2,M_2o)
        @test isapprox(expected_error_2,error_2o)

        M_3 = [ 8.75387801e-01;  1.36733727e+00; -2.06671771e-01; -4.89626363e-02;
                        3.60945024e-03;  5.07729589e-04; -2.48175025e-05; -2.48561588e-06;
                        9.09356531e-08;  7.07398165e-09; -2.06836247e-10; -1.31550450e-11;
                        3.20362427e-13;  1.72323883e-14; -3.59613936e-16]
        alphas_3 = [0.18998896132616549526]
        betas_3 = [-0.64021351452262786896]
        error_3 = 0.00000000000005539493
        expected_error_3 = 0.00000000000006372994
        expected_M_3 = [-0.00855022447641899143; 0.34186621455440019401; 0.00006322835752989059; -0.00042005189316723533; -0.00000003881104561047; 0.00000015464560890794; 0.00000000000952390464; -0.00000000002710314697; -0.00000000000000125172; 0.00000000000000277055; 0.00000000000000000010; -0.00000000000000000018; -0.00000000000000000000; 0.00000000000000000000; -0.00000000000000000000]
        M_3o, error_3o = transformCheb(M_3,alphas_3,betas_3,error_3,false)
        @test isapprox(expected_M_3,M_3o)
        @test isapprox(expected_error_3,error_3o,atol=2^-52)

        M_4 = reshape(collect(0:3*2*1*2-1),(2,1,2,3))
        alphas_4 = [0;.452345;1.2345;.231122]
        betas_4 = [.2345;.23223;.7134334;0]
        error_4 = 0.000000000000322211385
        expected_error_4 = 0.00000000000038909978
        expected_M_4 = [-7.45784067484999990683; -1.62556456928452175426;;;
                        -2.48481929227500009105; -0.53828204259785872310;;;;
                            0.;          0.        ;;;
                            0.;          0.        ]
        M_4o, error_4o = transformCheb(M_4,alphas_4,betas_4,error_4,false)
        @test isapprox(expected_error_4,error_4o)
        @test isapprox(expected_M_4,M_4o)

        M_5 = reshape(collect(0:3*2*1*2-1),(2,1,2,3))
        alphas_5 = [.34352340;1;1.2345;.231122]
        betas_5 = [.2345;0;.7134334;0]
        error_5 = 0.000000000000322211385
        expected_error_5 = 0.00000000000041332051
        expected_M_5 = [-5.23808938921952016443; -1.10374635329209302981;;;
                        -4.31311173652439983073; -0.88996366824589145939;;;;
                        3.95189319359999924330;  1.06723854865502154610;;;
                        5.28338989199999886637;  1.37497672858262620643;;;;
                        0.94406661078047993119;  0.24546888361890686903;;;
                        1.18008326347559999725;  0.30001752442310836155]
        M_5o, error_5o = transformCheb(M_5,alphas_5,betas_5,error_5,false)
        @test isapprox(expected_error_5,error_5o)
        @test isapprox(expected_M_5,M_5o)
    end
end

function test_transformChebToInterval()
    @testset "transformChebToInterval unit tests" begin
        macheps = 2^-52
        Ms_1 = [[ 0.87538780085034118006; 1.36733727263328685986; -0.20667177063640954082; -0.04896263625573957917; 0.00360945024389840467; 0.00050772958892000960; -0.00002481750254547087; -0.00000248561588318162; 0.00000009093565308793; 0.00000000707398165416; -0.00000000020683624682; -0.00000000001315504499; 0.00000000000032036243; 0.00000000000001723239; -0.00000000000000035961]]
        alphas_1 = [0.18998896132616549526]
        betas_1 = [-0.64021351452262786896]
        errors_1 = [0.00000000000005539493]
        expected_errors_1 = [0.00000000000006372994]
        expected_Ms_1 = [[-0.00855022633478066431; 0.34186621489582563749; 0.00006322836537617769; -0.00042005189300300673; -0.00000003881104085161; 0.00000015464560895305; 0.00000000000952390380; -0.00000000002710314699; -0.00000000000000125172; 0.00000000000000277055; 0.00000000000000000010; -0.00000000000000000018; -0.00000000000000000000; 0.00000000000000000000; -0.00000000000000000000]]
        Ms_1o, errors_1o = transformChebToInterval(Ms_1,alphas_1,betas_1,errors_1,false)
        @test isapprox(expected_errors_1,errors_1o,atol=macheps)
        @test isapprox(expected_Ms_1,Ms_1o)

        Ms_2 = [[ 3.01924445803718777270;  4.78499999999999836575;  1.36124999999999940492;;
                -0.13304144200672343712; -0.00000000000000024441; -0.00000000000000037332;;;
                50.84383924153893730136; -0.00000000000000597462; -0.00000000000000030931;;
                23.42301358514872333672; -0.00000000000000329309; -0.00000000000000213851;;;
                -0.31145740117566766969; -0.00000000000000073241; -0.00000000000000019330;;
                -0.00000000000000118391;  0.00000000000000017905; -0.00000000000000010959;;;
                9.13909584474152758560;  0.00000000000000010478;  0.00000000000000072048;;
                0.00000000000000255458; -0.00000000000000051092; -0.00000000000000051092],
                        
                [932.93997799570774986933;  1.64999999999995838884;;
                    945.73221846531237133604; -0.00000000000014671498;;
                    540.41841055160671203339;  0.00000000000007091879;;
                    202.65690395685254543423; 0.00000000000000180518 ;;
                    45.03486754596718100174;  0.00000000000000267724;;
                    4.50348675459674385735; -0.00000000000001079404;;;
                    -13.22075132104947670086; -0.00000000000003233820;;
                    -0.00000000000012654154;  0.00000000000001375977;;
                    -0.00000000000006407432; -0.00000000000004061001;;
                    -0.00000000000006077647; -0.00000000000004586719;;
                    -0.00000000000000629748;  0.00000000000000130028;;
                    0.00000000000003153795;  0.00000000000001081673;;;
                    485.39468239849583142131; -0.00000000000004222750;;
                    -0.00000000000001631828;  0.00000000000001482070;;
                    0.00000000000005187971;  0.00000000000001678736;;
                    0.00000000000010345949;  0.00000000000001756181;;
                    -0.00000000000001760717;  0.00000000000001734247;;
                    -0.00000000000001690204; -0.00000000000001203396;;;
                    -5.51296359377681621794;  0.00000000000001245752;;
                    0.00000000000002091485; -0.00000000000006070816;;
                    0.00000000000004539195;  0.00000000000000088580;;
                    0.00000000000002750763; -0.00000000000003376336;;
                    -0.00000000000004004082; -0.00000000000000568368;;
                    -0.00000000000000046638;  0.00000000000000991819;;;
                    121.32518559981021155636; -0.00000000000002328803;;
                    -0.00000000000001178903; -0.00000000000004658793;;
                    -0.00000000000000153725; -0.00000000000003502838;;
                    -0.00000000000001124342; -0.00000000000005690449;;
                    -0.00000000000000974588; -0.00000000000000975038;;
                     0.00000000000000514566;  0.00000000000001886741],

                [ 10.34553371598983595447; -4.78500000000000103029; -1.36125000000000007105;;
                    11.06872364918539020096; -0.00000000000000004282; -0.00000000000000004528;;
                    2.76718091229634755024;  0.00000000000000002637;  0.00000000000000004228;;;
                    -0.12512660205771153343; -0.00000000000000023779; -0.00000000000000019424;;
                    0.00000000000000076056; -0.00000000000000032959; -0.00000000000000011374;;
                    -0.00000000000000023138;  0.00000000000000020298;  0.00000000000000003926;;;
                    5.50738562295691647108;  0.0;  0.00000000000000004409;;
                    0.00000000000000009825;  0.0;  0.00000000000000009825;;
                    -0.00000000000000011976;  0.0; -0.00000000000000011976]]
        alphas_2 = [0.86417270870175955100; 0.75180342430703261947; 1.00000000000000000000]
        betas_2 = [-0.05938270010834456603; -0.24819657569296732502; 0.00000000000000000000]
        errors_2 = [0.00000000000048115600; 0.00000000003228496772; 0.00000000000017069713]
        expected_errors_2 = [0.00000000000064044592; 0.00000000004055030241; 0.00000000000023397781]
        Ms_2o, errors_2o = transformChebToInterval(Ms_2,alphas_2,betas_2,errors_2,false)
        @test isapprox(expected_errors_2,errors_2o)
        @test isapprox(Ms_2o[1][1,1,1], -0.35636471344922321380)
        @test isapprox(Ms_2o[1][1,1,4], 5.89800141442508252254)
        @test isapprox(Ms_2o[1][2,2,3], 0.00000000000000020273,atol=macheps)
        @test isapprox(Ms_2o[1][2,1,1], 4.78499999999999836575)
        @test isapprox(Ms_2o[1][1,1,3], -2.66432558431007482369)
        @test (3,2,4) == size(Ms_2o[1])
        @test isapprox(Ms_2o[2][1,1,1], 349.72917483078248324091)
        @test isapprox(Ms_2o[2][2,6,5], 0.00000000000000252718,atol=macheps)
        @test isapprox(Ms_2o[2][1,1,2], -120.31913788045511637392)
        @test isapprox(Ms_2o[2][2,1,1], 1.64999999999997859490)
        @test isapprox(Ms_2o[2][2,5,3], 0.00000000000002636738,atol=macheps)
        @test (2,6,5) == size(Ms_2o[2])
        @test isapprox(Ms_2o[3][1,1,1], 5.38786388015445449895)
        @test isapprox(Ms_2o[3][3,1,1], -1.36125000000000007105)
        @test isapprox(Ms_2o[3][1,2,2], 0.00000000000000060986,atol=macheps)
        @test isapprox(Ms_2o[3][1,1,3], 4.11288512994231325592)
        @test (3,3,3) == size(Ms_2o[3])
        
        Ms_3 = [[0.20653057333214039359;  0.38056300994434943963;  0.00679945356876563572;;
                    -1.15823104043916003114; -0.00000000000000000197; -0.00000000000000000017;;;
                    2.29212896076844208082; -0.00000000000000005616; -0.00000000000000000118;;
                    0.92770607573225138953; -0.00000000000000000696; -0.00000000000000000015;;;
                    -0.25276068645084059927; -0.00000000000000000310; -0.00000000000000000015;;
                    -0.00000000000000002707;  0.00000000000000000041;  0.00000000000000000001;;;
                    0.03374220633875571473;  0.00000000000000000022;  0.00000000000000000002;;
                    0.00000000000000000283; -0.00000000000000000005; -0.00000000000000000000],
                            
                [8.34766263464057267640;  0.11661435219359800319;;
                    4.91935192145770550098; -0.00000000000000910713;;
                    2.22691523728039753038;  0.00000000000000077721;;
                    0.58760510890271600015;  0.00000000000000020352;;
                    0.08367297770328245565; -0.00000000000000003376;;
                    0.00497664468239305061;  0.00000000000000000121;;;
                    -5.87289121056221130601; -0.00000000000000167424;;
                    -0.00000000000000119003; -0.00000000000000006629;;
                    0.00000000000001006357;  0.00000000000000016244;;
                    -0.00000000000000020161;  0.00000000000000006572;;
                    -0.00000000000000019103; -0.00000000000000001331;;
                    0.00000000000000001096;  0.00000000000000000055;;;
                    2.86688528973940259803; -0.00000000000000000130;;
                    0.00000000000000274690;  0.00000000000000029296;;
                    -0.00000000000000033228; -0.00000000000000005682;;
                    -0.00000000000000019912; -0.00000000000000001946;;
                    0.00000000000000003057;  0.00000000000000000375;;
                    -0.00000000000000000108; -0.00000000000000000015;;;
                    -0.69149027528736262127;  0.00000000000000001606;;
                    -0.00000000000000003733;  0.00000000000000000303;;
                    -0.00000000000000005442; -0.00000000000000000174;;
                    0.00000000000000000478; -0.00000000000000000062;;
                    0.00000000000000000053;  0.00000000000000000013;;
                    -0.00000000000000000004; -0.00000000000000000001;;;
                    0.06923270350389446048; -0.00000000000000000101;;
                    -0.00000000000000001179; -0.00000000000000000139;;
                    0.00000000000000000063;  0.00000000000000000036;;
                    0.00000000000000000088;  0.00000000000000000010;;
                    -0.00000000000000000013; -0.00000000000000000002;;
                    0.0;  0.0],

                [-0.91853343720207980549; -0.38056300994434966167; -0.00679945356876563746;;
                    1.22208449103886085396; -0.00000000000000000268; -0.00000000000000000056;;
                    0.18171578359893975074; 0.00000000000000000024; 0.00000000000000000005;;;

                    -0.65700767064571219400; -0.00000000000000000194; -0.00000000000000000012;;
                    0.00000000000000005502; -0.00000000000000000281; -0.00000000000000000010;;
                    -0.00000000000000000248;  0.00000000000000000019;  0.00000000000000000001;;;

                    0.13156054072545317335;  0.00000000000000000002;  0.00000000000000000000;;
                    0.00000000000000000007;  0.00000000000000000007;  0.00000000000000000001;;
                    -0.00000000000000000001; -0.00000000000000000001; -0.0]]
        alphas_3 = [0.73688366977641883704; 0.95966057059377973815; 0.15397785734628577359]
        betas_3 = [0.26311633022358116296; -0.04033942940622026185; -0.84602214265371422641]
        errors_3 = [0.00000000000107853114; 0.00000000005026591813; 0.00000000000042185498]
        expected_errors_3 = [0.00000000000108814021; 0.00000000005032364909; 0.00000000000042866658]
        Ms_3o, errors_3o = transformChebToInterval(Ms_3,alphas_3,betas_3,errors_3,false)
        @test isapprox(expected_errors_3,errors_3o)
        @test isapprox(Ms_3o[1][1,1,1], 0.61289723392602202257)
        @test isapprox(Ms_3o[1][1,1,2], 1.45199604818886451874)
        @test isapprox(Ms_3o[1][3,2,4], 0.0)
        @test isapprox(Ms_3o[1][1,1,3], -0.10832362965094881335)
        @test isapprox(Ms_3o[1][3,1,1], 0.00016120947232328597)
        @test (3,2,4) == size(Ms_3o[1])
        @test isapprox(Ms_3o[2][1,1,1], 5.26249570529796883989)
        @test isapprox(Ms_3o[2][1,1,2], -1.83906340673611534697)
        @test isapprox(Ms_3o[2][1,1,5], 0.02041300864577325416)
        @test isapprox(Ms_3o[2][2,1,1], 0.01795602808659533395)
        @test isapprox(Ms_3o[2][1,5,4], 0.00000000000000000007,atol=macheps)
        @test isapprox(Ms_3o[2][2,1,2], -0.00000000000000019348,atol=macheps)
        @test (2, 6, 5) == size(Ms_3o[2])
        @test isapprox(Ms_3o[3][1,1,1], -0.87751264801507178337)
        @test isapprox(Ms_3o[3][1,1,2], -0.38210716859108229126)
        @test isapprox(Ms_3o[3][2,1,1], -0.05505525357920099810)
        @test isapprox(Ms_3o[3][2,2,3], 0.0,atol=macheps)
        @test isapprox(Ms_3o[3][2,2,2], -0.00000000000000000027,atol=macheps)
        @test (3, 3, 3) == size(Ms_3o[3])

        Ms_4 = [reshape(collect(0:3*2*2*3-1),(3,2,2,3)),reshape(collect(0:3*3*2*3-1),(3,2,3,3)),reshape(collect(1:4*2*2*2),(2,2,2,4)),reshape(collect(0:4*2*2*2-1),(2,2,2,4))]
        alphas_4 = [0.73688366977641883704; 0.95966057059377973815; 0.15397785734628577359;.293846263523452]
        betas_4 = [.199884327734;0.26311633022358116296; -0.04033942940622026185; -0.84602214265371422641]
        errors_4 = [.00000234789324;.000000000000004234;.000233333334;.00000009234324]
        expected_errors_5 = [0.00000234789445040824; 0.00000000000338671467; 0.00023333333491046737; 0.00000009234409761910]
        expected_Ms_4o_2 = [-1.08712410884770815933; 0.02187078161082947614;;
                                 -0.11786482249235769038; 0.11145519450050471455;;;
                                -0.41896033535596521880; 0.79330091989472983904;;
                                -0.02424701317422695013; 0.20929806351267382647;;;;
                                -0.55090590156698648894; 0.49640100317745783354;;
                                -0.04663452429610065453; 0.15933826999251132772;;;
                                -0.11809677021439801692; 0.95052686993315538277;;
                                0.01277762488328693102; 0.21305775899590809197;;;;
                                3.70391347172445506430; 9.83095256818280560651;;
                                0.66882837450361698473; 1.71961826646099957827;;;
                                3.35035417210369246277; 8.49255208687496576658;;
                                0.59419328771026957980; 1.47069952026760963903;;;;
                                1.51266334971313654023; 3.81230906305421246572;;
                                0.26768024021084824149; 0.65934372035125055067;;;
                                1.32893849639622985137; 3.23932689869999634880;;
                                0.23220194341292943463; 0.55595913535956786866]
        expected_Ms_4o_3 = [-1.25628180830922575595; -0.30094419185125614868;;
                                -0.14500623156431272087; 0.05965942477096922852;;;
                                -0.54747896068070800446; 0.54804021490961907226;;
                                -0.04486786930083647151; 0.16994590192341496593;;;;
                                -0.67578565587819638960; 0.25808459959516849569;;
                                -0.06667152235977241714; 0.12110032387019763200;;;
                                -0.21297494842359654399; 0.76946448448908788542;;
                                -0.00244561032844214932; 0.18400623910337496336;;;;
                                3.48101720733306763123; 9.40558469014145970277;;
                                0.63306459483697619106; 1.65136784912415235382;;;
                                3.18100733432573790083; 8.16937616808910860300;;
                                0.56702153133261212758; 1.41884583674097086714;;;;
                                1.43798132738737116654; 3.66978835526537272571;;
                                0.25569748491967914106; 0.63647622544185411542;;;
                                1.27219836055652102402; 3.13104589521248888317;;
                                0.22309796976865481355; 0.53858541237958135195]
        Ms_4o,errors_4o = transformChebToInterval(Ms_4,alphas_4,betas_4,errors_4,false)
        @test isapprox(expected_errors_5,errors_4o)
        @test isapprox(Ms_4o[1][1,1,1,1], -4.47475873930734557860)
        @test isapprox(Ms_4o[1][2,1,1,1], 3.17287986215911832488)
        @test isapprox(Ms_4o[1][2,1,2,3], -11.31328479941790376984)
        @test isapprox(Ms_4o[1][2,1,2,2], -21.92304469635405439476)
        @test (3,2,2,3) == size(Ms_4o[1])
        @test isapprox(Ms_4o[2][1,1,1,1], -7.18227192058273544717)
        @test isapprox(Ms_4o[2][3,2,3,3], 0.35237708132216383206)
        @test isapprox(Ms_4o[2][3,2,1,3], 0.40800102086722889183)
        @test (3,2,3,3) == size(Ms_4o[2])
        @test isapprox(Ms_4o[3], expected_Ms_4o_2)
        @test (2,2,2,4) == size(Ms_4o[3])
        @test isapprox(Ms_4o[4], expected_Ms_4o_3)
        @test (2,2,2,4) == size(Ms_4o[4])
    end
end